<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Horrell">

<title>Lab 1: COVID-19 Trends – ESS 523c Labs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d13ac4e80c000af260af3917723b819e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-175319157c5a1d45805a17fae5d1b6b1.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/tabwid-1.1.3/tabwid.css" rel="stylesheet">

<script src="site_libs/tabwid-1.1.3/tabwid.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ESS 523c Labs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link active" data-scroll-target="#load-libraries">Load Libraries</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#question-1-daily-summary" id="toc-question-1-daily-summary" class="nav-link" data-scroll-target="#question-1-daily-summary"><strong>Question 1</strong>: Daily Summary</a>
  <ul class="collapse">
  <li><a href="#steps" id="toc-steps" class="nav-link" data-scroll-target="#steps">Steps:</a></li>
  </ul></li>
  <li><a href="#question-2-evaluating-census-data-eda" id="toc-question-2-evaluating-census-data-eda" class="nav-link" data-scroll-target="#question-2-evaluating-census-data-eda"><strong>Question 2</strong>: Evaluating Census Data (EDA)</a>
  <ul class="collapse">
  <li><a href="#steps-1" id="toc-steps-1" class="nav-link" data-scroll-target="#steps-1">Steps:</a></li>
  </ul></li>
  <li><a href="#question-3-per-capita-summary" id="toc-question-3-per-capita-summary" class="nav-link" data-scroll-target="#question-3-per-capita-summary"><strong>Question 3</strong>: Per Capita Summary</a></li>
  <li><a href="#question-4-rolling-thresholds" id="toc-question-4-rolling-thresholds" class="nav-link" data-scroll-target="#question-4-rolling-thresholds"><strong>Question 4:</strong> Rolling thresholds</a></li>
  <li><a href="#question-5-death-toll" id="toc-question-5-death-toll" class="nav-link" data-scroll-target="#question-5-death-toll"><strong>Question 5</strong>: Death toll</a></li>
  <li><a href="#question-6-multi-state" id="toc-question-6-multi-state" class="nav-link" data-scroll-target="#question-6-multi-state"><strong>Question 6</strong>: Multi-state</a>
  <ul class="collapse">
  <li><a href="#steps-2" id="toc-steps-2" class="nav-link" data-scroll-target="#steps-2">Steps:</a></li>
  </ul></li>
  <li><a href="#question-7-space-time" id="toc-question-7-space-time" class="nav-link" data-scroll-target="#question-7-space-time"><strong>Question 7</strong>: Space &amp; Time</a></li>
  <li><a href="#question-8-trends" id="toc-question-8-trends" class="nav-link" data-scroll-target="#question-8-trends"><strong>Question 8:</strong> Trends</a>
  <ul class="collapse">
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#model-building" id="toc-model-building" class="nav-link" data-scroll-target="#model-building">Model Building</a></li>
  </ul></li>
  <li><a href="#question-9-evaluation" id="toc-question-9-evaluation" class="nav-link" data-scroll-target="#question-9-evaluation"><strong>Question 9:</strong> Evaluation</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 1: COVID-19 Trends</h1>
<p class="subtitle lead">Public Health &amp; Time: Data Science Tools</p>
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kevin Horrell <a href="mailto:kevin.horrell@colostate.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data/nyt-covid.png" class="img-fluid figure-img"></p>
<figcaption>COVID-19</figcaption>
</figure>
</div>
<section id="load-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries">Load Libraries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flextable)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this lab I practiced data wrangling and visualization skills using COVID-19 data curated by the New York Times. This is a large dataset measuring the cases and deaths per US county across the lifespan of COVID from its early beginnings to just beyond its peak in 2023. The data stored in daily cumulative counts is messy and is a great example of data that needs to be wrangled and cleaned before any analysis can be done.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>This data was used during the peak of the COVID-19 pandemic to create reports and data visualizations like <a href="https://www.nytimes.com/interactive/2020/us/coronavirus-spread.html?referringSource=articleShare">this</a>, and are archived on a GitHub repo <a href="https://github.com/nytimes/covid-19-data">here</a>. A history of the importance can be found <a href="https://www.nytimes.com/2023/03/22/us/covid-data-cdc.html">here</a>.</p>
<p>Imagine it is <em>Feb 1st, 2022</em>. As a data scientist for the state of Colorado Department of Public Health, I have been tasked with giving a report to Governor Polis each morning about the most current COVID-19 conditions at the county level.</p>
<p>As it stands, the Colorado Department of Public Health maintains a watch list of counties that are being monitored for worsening COVID trends. There are six criteria used to place counties on the watch list:</p>
<ol type="1">
<li>Doing fewer than 150 tests per 100,000 residents daily (over a 7-day average)</li>
<li>More than 100 new cases per 100,000 residents over the past 14 days…</li>
<li>25 new cases per 100,000 residents and an 8% test positivity rate</li>
<li>10% or greater increase in COVID-19 hospitalized patients over the past 3 days</li>
<li>Fewer than 20% of ICU beds available</li>
<li>Fewer than 25% ventilators available</li>
</ol>
<p><strong>Of these 6 conditions, I am responsible for monitoring condition 2.</strong></p>
</section>
<section id="question-1-daily-summary" class="level1">
<h1><strong>Question 1</strong>: Daily Summary</h1>
<p>NYT COVID data repository README:</p>
<blockquote class="blockquote">
<p>“We are providing two sets of data with cumulative counts of coronavirus cases and deaths: one with our most current numbers for each geography and another with historical data showing the tally for each day for each geography … the historical files are the final counts at the end of each day … The historical and live data are released in three files, one for each of these geographic levels: U.S., states and counties.”</p>
</blockquote>
<p>To start, I set up a reproducible framework to communicate the following in a way that can be updated every time new data is released (daily):</p>
<ol type="1">
<li>cumulative cases in the 5 worst counties</li>
<li>total <strong>NEW</strong> cases in the 5 worst counties</li>
<li>A list of safe counties</li>
</ol>
<p>The analysis is built so that running it will extract the most current data straight from the NY-Times URL and the state name and date are parameters that can be changed allowing this report to be run for other states/dates.</p>
<section id="steps" class="level2">
<h2 class="anchored" data-anchor-id="steps">Steps:</h2>
<ol type="a">
<li><p>Read in the data from the NY-Times URL with <code>read_csv</code> using <code>tidyverse</code>. The data read from Github is considered the “raw data”. I leave “raw-data-raw” and generate meaningful subsets of data as I go.</p></li>
<li><p>Create an object called <code>my.date</code> and set it as “2022-02-01” - ensure this is a <code>date</code> object.</p></li>
<li><p>Create a object called <code>my.state</code> and set it to “Colorado”.</p></li>
<li><p>Start by making a subset that limits the data to Colorado, and add a new column with the daily <em>new cases</em> by county. Do the same for <em>new deaths</em>.</p></li>
<li><p>Using your subset, generate (<strong>2</strong>) tables. The first should show the 5 counties with the most <strong>CUMULATIVE</strong> cases on your date of interest, and the second should show the 5 counties with the most <strong>NEW</strong> cases on that same date.</p></li>
</ol>
<p>Read in Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Initial Objects</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>my.date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2022-02-01"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>my.state <span class="ot">&lt;-</span> <span class="st">"Colorado"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Colorado Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>co_dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">==</span> my.state) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_cases =</span> cases <span class="sc">-</span> <span class="fu">lag</span>(cases, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">new_deaths =</span> deaths <span class="sc">-</span> <span class="fu">lag</span>(deaths, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Data Tables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>co_dat_cum <span class="ot">&lt;-</span> co_dat <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> my.date)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(co_dat_cum, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> cases) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, state, cases, new_cases, deaths) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Top 5 Counties with Most Cumulative Cases"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_zebra</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-9c3ba600{}.cl-9c2f5d3c{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9c2f5d6e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9c35ecc4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9c35ecd8{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9c361046{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c361050{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c36105a{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c36105b{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c36105c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c361064{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9c3ba600"><thead><tr style="overflow-wrap:break-word;"><th class="cl-9c361046"><p class="cl-9c35ecc4"><span class="cl-9c2f5d3c">county</span></p></th><th class="cl-9c361046"><p class="cl-9c35ecc4"><span class="cl-9c2f5d3c">state</span></p></th><th class="cl-9c361050"><p class="cl-9c35ecd8"><span class="cl-9c2f5d3c">cases</span></p></th><th class="cl-9c361050"><p class="cl-9c35ecd8"><span class="cl-9c2f5d3c">new_cases</span></p></th><th class="cl-9c361050"><p class="cl-9c35ecd8"><span class="cl-9c2f5d3c">deaths</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9c36105a"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">El Paso</span></p></td><td class="cl-9c36105a"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Colorado</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">170,673</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">630</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">1,518</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c36105c"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Denver</span></p></td><td class="cl-9c36105c"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Colorado</span></p></td><td class="cl-9c361064"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">159,022</span></p></td><td class="cl-9c361064"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">389</span></p></td><td class="cl-9c361064"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">1,194</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c36105a"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Arapahoe</span></p></td><td class="cl-9c36105a"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Colorado</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">144,255</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">401</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">1,172</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c36105c"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Adams</span></p></td><td class="cl-9c36105c"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Colorado</span></p></td><td class="cl-9c361064"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">126,768</span></p></td><td class="cl-9c361064"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">326</span></p></td><td class="cl-9c361064"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">1,224</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c36105a"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Jefferson</span></p></td><td class="cl-9c36105a"><p class="cl-9c35ecc4"><span class="cl-9c2f5d6e">Colorado</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">113,240</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">291</span></p></td><td class="cl-9c36105b"><p class="cl-9c35ecd8"><span class="cl-9c2f5d6e">1,219</span></p></td></tr></tbody></table></div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(co_dat_cum, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, state, cases, new_cases, deaths) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Top 5 Counties with New Cases"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_zebra</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-9c52ccea{}.cl-9c478934{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9c478948{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9c4b979a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9c4b97a4{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9c4da788{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c4da792{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c4da793{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c4da79c{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c4da79d{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9c4da7a6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9c52ccea"><thead><tr style="overflow-wrap:break-word;"><th class="cl-9c4da788"><p class="cl-9c4b979a"><span class="cl-9c478934">county</span></p></th><th class="cl-9c4da788"><p class="cl-9c4b979a"><span class="cl-9c478934">state</span></p></th><th class="cl-9c4da792"><p class="cl-9c4b97a4"><span class="cl-9c478934">cases</span></p></th><th class="cl-9c4da792"><p class="cl-9c4b97a4"><span class="cl-9c478934">new_cases</span></p></th><th class="cl-9c4da792"><p class="cl-9c4b97a4"><span class="cl-9c478934">deaths</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9c4da793"><p class="cl-9c4b979a"><span class="cl-9c478948">El Paso</span></p></td><td class="cl-9c4da793"><p class="cl-9c4b979a"><span class="cl-9c478948">Colorado</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">170,673</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">630</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">1,518</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c4da79d"><p class="cl-9c4b979a"><span class="cl-9c478948">Arapahoe</span></p></td><td class="cl-9c4da79d"><p class="cl-9c4b979a"><span class="cl-9c478948">Colorado</span></p></td><td class="cl-9c4da7a6"><p class="cl-9c4b97a4"><span class="cl-9c478948">144,255</span></p></td><td class="cl-9c4da7a6"><p class="cl-9c4b97a4"><span class="cl-9c478948">401</span></p></td><td class="cl-9c4da7a6"><p class="cl-9c4b97a4"><span class="cl-9c478948">1,172</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c4da793"><p class="cl-9c4b979a"><span class="cl-9c478948">Denver</span></p></td><td class="cl-9c4da793"><p class="cl-9c4b979a"><span class="cl-9c478948">Colorado</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">159,022</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">389</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">1,194</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c4da79d"><p class="cl-9c4b979a"><span class="cl-9c478948">Adams</span></p></td><td class="cl-9c4da79d"><p class="cl-9c4b979a"><span class="cl-9c478948">Colorado</span></p></td><td class="cl-9c4da7a6"><p class="cl-9c4b97a4"><span class="cl-9c478948">126,768</span></p></td><td class="cl-9c4da7a6"><p class="cl-9c4b97a4"><span class="cl-9c478948">326</span></p></td><td class="cl-9c4da7a6"><p class="cl-9c4b97a4"><span class="cl-9c478948">1,224</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9c4da793"><p class="cl-9c4b979a"><span class="cl-9c478948">Jefferson</span></p></td><td class="cl-9c4da793"><p class="cl-9c4b979a"><span class="cl-9c478948">Colorado</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">113,240</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">291</span></p></td><td class="cl-9c4da79c"><p class="cl-9c4b97a4"><span class="cl-9c478948">1,219</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
</section>
<section id="question-2-evaluating-census-data-eda" class="level1">
<h1><strong>Question 2</strong>: Evaluating Census Data (EDA)</h1>
<p>Raw count data can be deceiving given the wide range of populations in Colorado countries. To help normalize data counts, additional information is needed on the population of each county.</p>
<p>Population data is offered by the Census Bureau is found <a href="https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pop_url <span class="ot">&lt;-</span> <span class="st">'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
FIPs codes: Federal Information Processing
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>How FIPS codes are used</strong><br>
- FIPS codes are used in census products<br>
- FIPS codes are used to identify geographic areas in files<br>
- FIPS codes are used to identify American Indian, Alaska Native, and Native Hawaiian (AIANNH) areas<br>
</p>
<p><strong>How FIPS codes are structured</strong><br>
- The number of digits in a FIPS code depends on the level of geography<br>
- State FIPS codes have two digits<br>
- County FIPS codes have five digits, with the first two digits representing the state FIPS code<br>
</p>
</div>
</div>
<p>The COVID data provides a 5 digit character FIP code representing the state in the first 2 digits and the county in the last 3. In the population data, the STATE and COUNTY FIP identifiers are in separate columns. To make these compatible I need to create a FIP variable that concatinates (combines) the 2 digit STATE and the 3 digit COUNTY FIP.</p>
<section id="steps-1" class="level2">
<h2 class="anchored" data-anchor-id="steps-1">Steps:</h2>
<ol type="a">
<li>Created a five digit FIP variable and only keep columns that contain “NAME” or “2021”. Additionally all state level rows (e.g.&nbsp;COUNTY FIP == “000”) are removed.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(pop_url)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pop_colo <span class="ot">&lt;-</span> pop_data <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STNAME <span class="sc">==</span> <span class="st">'Colorado'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTY <span class="sc">&gt;</span> <span class="st">'000'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fips =</span> <span class="fu">paste0</span>(STATE, COUNTY)) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fips, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">'NAME'</span>, <span class="st">'2021'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="a">
<li>Description of data after manipulation:</li>
</ol>
<p><em>I intentionally named the “fips” column “fips” to match with the COVID data for Colorado. I knew we would be merging these data tables together. The “pop_colo” data contains information about estimated population, deaths, births, and immigration statistics by county in Colorado. There are 19 columns, and 64 rows for the 64 counties. I like these functions for browsing the data: names(), glimpse(), head(), and summary(). The skim() function is sort of like the summary() function but needs the skimr package installed.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pop_colo)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(pop_colo)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(pop_colo)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pop_colo)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(pop_colo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="question-3-per-capita-summary" class="level1">
<h1><strong>Question 3</strong>: Per Capita Summary</h1>
<p>Join the population data to the Colorado COVID data and compute the per capita cumulative cases, per capita new cases, and per capita new deaths:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>colo_join <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(pop_colo, co_dat, <span class="at">by =</span> <span class="st">'fips'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>colo_join_tidy <span class="ot">&lt;-</span> colo_join <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fips, POPESTIMATE2021, DEATHS2021, date, county, state, cases, deaths, new_cases, new_deaths)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>colo_join_mydate <span class="ot">&lt;-</span> colo_join_tidy <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> my.date) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">casespc =</span> cases<span class="sc">/</span>POPESTIMATE2021,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">newcasespc =</span> new_cases<span class="sc">/</span>POPESTIMATE2021,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdeathspc =</span> new_deaths<span class="sc">/</span>POPESTIMATE2021)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generate (<strong>2</strong>) new tables. The first should show the 5 counties with the most cumulative cases per capita on your date, and the second should show the 5 counties with the most <strong>NEW</strong> cases per capita on the same date. Your tables should have clear column names and descriptive captions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(colo_join_mydate, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> casespc) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, state, county, POPESTIMATE2021, cases, new_cases, casespc) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Top 5 Counties with Most Cumulative Cases per Capita"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_zebra</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-9d14cef8{}.cl-9d0b08e6{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9d0b08fa{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9d0f7a20{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9d0f7a2a{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9d0f9a6e{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d0f9a78{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d0f9a82{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d0f9a83{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d0f9a8c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d0f9a96{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9d14cef8"><thead><tr style="overflow-wrap:break-word;"><th class="cl-9d0f9a6e"><p class="cl-9d0f7a20"><span class="cl-9d0b08e6">date</span></p></th><th class="cl-9d0f9a78"><p class="cl-9d0f7a2a"><span class="cl-9d0b08e6">state</span></p></th><th class="cl-9d0f9a78"><p class="cl-9d0f7a2a"><span class="cl-9d0b08e6">county</span></p></th><th class="cl-9d0f9a6e"><p class="cl-9d0f7a20"><span class="cl-9d0b08e6">POPESTIMATE2021</span></p></th><th class="cl-9d0f9a6e"><p class="cl-9d0f7a20"><span class="cl-9d0b08e6">cases</span></p></th><th class="cl-9d0f9a6e"><p class="cl-9d0f7a20"><span class="cl-9d0b08e6">new_cases</span></p></th><th class="cl-9d0f9a6e"><p class="cl-9d0f7a20"><span class="cl-9d0b08e6">casespc</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2022-02-01</span></p></td><td class="cl-9d0f9a83"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Colorado</span></p></td><td class="cl-9d0f9a83"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Crowley</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">5,735</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2,935</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">56</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">0.5117698</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2022-02-01</span></p></td><td class="cl-9d0f9a96"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Colorado</span></p></td><td class="cl-9d0f9a96"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Bent</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">5,339</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2,199</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">22</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">0.4118749</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2022-02-01</span></p></td><td class="cl-9d0f9a83"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Colorado</span></p></td><td class="cl-9d0f9a83"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Pitkin</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">17,337</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">5,946</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">7</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">0.3429659</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2022-02-01</span></p></td><td class="cl-9d0f9a96"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Colorado</span></p></td><td class="cl-9d0f9a96"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Lincoln</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">5,473</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">1,874</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">5</span></p></td><td class="cl-9d0f9a8c"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">0.3424082</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">2022-02-01</span></p></td><td class="cl-9d0f9a83"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Colorado</span></p></td><td class="cl-9d0f9a83"><p class="cl-9d0f7a2a"><span class="cl-9d0b08fa">Logan</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">21,006</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">6,402</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">25</span></p></td><td class="cl-9d0f9a82"><p class="cl-9d0f7a20"><span class="cl-9d0b08fa">0.3047701</span></p></td></tr></tbody></table></div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(colo_join_mydate, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> newcasespc) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, state, county, POPESTIMATE2021, cases, new_cases, newcasespc) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Top 5 Counties with Most New Cases per Capita"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_zebra</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-9d2b51be{}.cl-9d2240f6{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9d22410a{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9d262536{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9d262540{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9d2645ca{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d2645d4{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d2645d5{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d2645de{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d2645df{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d2645e0{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9d2b51be"><thead><tr style="overflow-wrap:break-word;"><th class="cl-9d2645ca"><p class="cl-9d262536"><span class="cl-9d2240f6">date</span></p></th><th class="cl-9d2645d4"><p class="cl-9d262540"><span class="cl-9d2240f6">state</span></p></th><th class="cl-9d2645d4"><p class="cl-9d262540"><span class="cl-9d2240f6">county</span></p></th><th class="cl-9d2645ca"><p class="cl-9d262536"><span class="cl-9d2240f6">POPESTIMATE2021</span></p></th><th class="cl-9d2645ca"><p class="cl-9d262536"><span class="cl-9d2240f6">cases</span></p></th><th class="cl-9d2645ca"><p class="cl-9d262536"><span class="cl-9d2240f6">new_cases</span></p></th><th class="cl-9d2645ca"><p class="cl-9d262536"><span class="cl-9d2240f6">newcasespc</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">2022-02-01</span></p></td><td class="cl-9d2645de"><p class="cl-9d262540"><span class="cl-9d22410a">Colorado</span></p></td><td class="cl-9d2645de"><p class="cl-9d262540"><span class="cl-9d22410a">Crowley</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">5,735</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">2,935</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">56</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">0.009764603</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">2022-02-01</span></p></td><td class="cl-9d2645e0"><p class="cl-9d262540"><span class="cl-9d22410a">Colorado</span></p></td><td class="cl-9d2645e0"><p class="cl-9d262540"><span class="cl-9d22410a">Bent</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">5,339</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">2,199</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">22</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">0.004120622</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">2022-02-01</span></p></td><td class="cl-9d2645de"><p class="cl-9d262540"><span class="cl-9d22410a">Colorado</span></p></td><td class="cl-9d2645de"><p class="cl-9d262540"><span class="cl-9d22410a">Sedgwick</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">2,326</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">441</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">9</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">0.003869304</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">2022-02-01</span></p></td><td class="cl-9d2645e0"><p class="cl-9d262540"><span class="cl-9d22410a">Colorado</span></p></td><td class="cl-9d2645e0"><p class="cl-9d262540"><span class="cl-9d22410a">Washington</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">4,868</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">937</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">14</span></p></td><td class="cl-9d2645df"><p class="cl-9d262536"><span class="cl-9d22410a">0.002875924</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">2022-02-01</span></p></td><td class="cl-9d2645de"><p class="cl-9d262540"><span class="cl-9d22410a">Colorado</span></p></td><td class="cl-9d2645de"><p class="cl-9d262540"><span class="cl-9d22410a">Las Animas</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">14,334</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">3,183</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">38</span></p></td><td class="cl-9d2645d5"><p class="cl-9d262536"><span class="cl-9d22410a">0.002651039</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
<section id="question-4-rolling-thresholds" class="level1">
<h1><strong>Question 4:</strong> Rolling thresholds</h1>
<p>Filter the merged COVID/Population data for Colorado to only include the last 14 days. Then, use the <code>group_by</code>/<code>summarize</code> paradigm to determine the total number of new cases in the last 14 days per 100,000 people.</p>
<p>Print a table of the top 5 counties, and, report the number of counties that meet the watch list condition: “More than 100 new cases per 100,000 residents over the past 14 days…”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>colo_join_14 <span class="ot">&lt;-</span> colo_join_tidy <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> my.date <span class="sc">-</span> <span class="dv">14</span> <span class="sc">&amp;</span> date <span class="sc">&lt;=</span> my.date)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>colo_join_sum <span class="ot">&lt;-</span> colo_join_14 <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county, POPESTIMATE2021) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_new_cases =</span> <span class="fu">sum</span>(new_cases)) <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_new_cases_std =</span> total_new_cases<span class="sc">/</span>POPESTIMATE2021<span class="sc">*</span><span class="dv">100000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_max</span>(colo_join_sum, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">order_by =</span> tot_new_cases_std) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(county, POPESTIMATE2021, tot_new_cases_std) <span class="sc">%&gt;%</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">flextable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">"Top 5 Counties with Most New Cases per 100,000 people over the last 14 days"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_zebra</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="tabwid"><style>.cl-9d4ce1b2{}.cl-9d444778{font-family:'Arial';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9d444782{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9d47bc00{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9d47bc14{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9d47dae6{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d47dafa{width:0.75in;background-color:rgba(207, 207, 207, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d47dafb{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d47db04{width:0.75in;background-color:rgba(239, 239, 239, 1.00);vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d47db05{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9d47db06{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing="true" class="cl-9d4ce1b2"><thead><tr style="overflow-wrap:break-word;"><th class="cl-9d47dae6"><p class="cl-9d47bc00"><span class="cl-9d444778">county</span></p></th><th class="cl-9d47dafa"><p class="cl-9d47bc14"><span class="cl-9d444778">POPESTIMATE2021</span></p></th><th class="cl-9d47dafa"><p class="cl-9d47bc14"><span class="cl-9d444778">tot_new_cases_std</span></p></th></tr></thead><tbody><tr style="overflow-wrap:break-word;"><td class="cl-9d47dafb"><p class="cl-9d47bc00"><span class="cl-9d444782">Crowley</span></p></td><td class="cl-9d47db04"><p class="cl-9d47bc14"><span class="cl-9d444782">5,735</span></p></td><td class="cl-9d47db04"><p class="cl-9d47bc14"><span class="cl-9d444782">5,475.153</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d47db05"><p class="cl-9d47bc00"><span class="cl-9d444782">Lincoln</span></p></td><td class="cl-9d47db06"><p class="cl-9d47bc14"><span class="cl-9d444782">5,473</span></p></td><td class="cl-9d47db06"><p class="cl-9d47bc14"><span class="cl-9d444782">3,763.932</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d47dafb"><p class="cl-9d47bc00"><span class="cl-9d444782">Alamosa</span></p></td><td class="cl-9d47db04"><p class="cl-9d47bc14"><span class="cl-9d444782">16,579</span></p></td><td class="cl-9d47db04"><p class="cl-9d47bc14"><span class="cl-9d444782">3,757.766</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d47db05"><p class="cl-9d47bc00"><span class="cl-9d444782">Mineral</span></p></td><td class="cl-9d47db06"><p class="cl-9d47bc14"><span class="cl-9d444782">929</span></p></td><td class="cl-9d47db06"><p class="cl-9d47bc14"><span class="cl-9d444782">3,336.921</span></p></td></tr><tr style="overflow-wrap:break-word;"><td class="cl-9d47dafb"><p class="cl-9d47bc00"><span class="cl-9d444782">Conejos</span></p></td><td class="cl-9d47db04"><p class="cl-9d47bc14"><span class="cl-9d444782">7,582</span></p></td><td class="cl-9d47db04"><p class="cl-9d47bc14"><span class="cl-9d444782">3,336.850</span></p></td></tr></tbody></table></div>
</div>
</div>
</section>
<section id="question-5-death-toll" class="level1">
<h1><strong>Question 5</strong>: Death toll</h1>
<p>Your leadership has now asked you to determine what percentage of deaths in each county were attributed to COVID last year (2021). You eagerly tell them that with the current Census data, you can do this!</p>
<p>Find the ratio of total COVID deaths per county in 2021 of all recorded deaths. In a plot of your choosing, visualize all counties where COVID deaths account for 20% or more of the annual death toll.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dates in R
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To extract a element of a date object in R, the <code>lubridate</code> package (part of <code>tidyverse</code>) is very helpful:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>tmp.date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2025-02-15"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">year</span>(tmp.date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2025</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">month</span>(tmp.date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lubridate<span class="sc">::</span><span class="fu">yday</span>(tmp.date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>colo_join_2021 <span class="ot">&lt;-</span> colo_join_tidy <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>colo_2021_deaths <span class="ot">&lt;-</span> colo_join_2021 <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(county, fips, POPESTIMATE2021, DEATHS2021, year, state) <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_new_deaths =</span> <span class="fu">sum</span>(new_deaths)) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent_deaths =</span> total_new_deaths<span class="sc">/</span>DEATHS2021<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>percent_deaths2021 <span class="ot">&lt;-</span> colo_2021_deaths <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(percent_deaths <span class="sc">&gt;=</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> percent_deaths2021) <span class="sc">+</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> county, <span class="at">y =</span> percent_deaths, <span class="at">fill =</span> percent_deaths)) <span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">20</span>, <span class="at">linetype =</span> <span class="st">'dashed'</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>() <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">'Greens'</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">guide =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'County'</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Percent Deaths'</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Counties in Colorado with more than 20% COVID-19 Deaths in 2021'</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="question-6-multi-state" class="level1">
<h1><strong>Question 6</strong>: Multi-state</h1>
<p>Congratulations! You have been promoted to the National COVID-19 Task Force. Now I have been tasked with building analysis to compare states to each other.</p>
<p>In this question, I look at the story of 4 states and the impact scale can have on data interpretation. The states include: <strong>New York</strong>, <strong>Colorado</strong>, <strong>Alabama</strong>, and <strong>Ohio</strong>.</p>
<p>I must make a <em>faceted</em> bar plot showing the number of daily, <strong>new</strong> cases at the state level.</p>
<section id="steps-2" class="level2">
<h2 class="anchored" data-anchor-id="steps-2">Steps:</h2>
<ol type="a">
<li>I need to group/summarize the county level data to the state level and filter it to my four states of interest. Then calculate the number daily new cases and the 7-day rolling mean.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Rolling Averages
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>rollmean</code> function from the <code>zoo</code> package in R is used to compute the rolling (moving) mean of a numeric vector, matrix, or <code>zoo</code>/<code>ts</code> object.</p>
<p><code>rollmean(x, k, fill = NA, align = "center", na.pad = FALSE)</code><br>
- <code>x</code>: Numeric vector, matrix, or time series.<br>
- <code>k</code>: Window size (number of observations).<br>
- <code>fill</code>: Values to pad missing results (default NA).<br>
- <code>align</code>: Position of the rolling window (“center”, “left”, “right”).<br>
- <code>na.pad</code>: If TRUE, pads missing values with NA.<br>
</p>
<section id="examples" class="level4">
<h4 class="anchored" data-anchor-id="examples">Examples</h4>
<ol type="1">
<li>Rolling Mean on a Numeric Vector Since <code>align = "center"</code> by default, values at the start and end are dropped.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Rolling mean with a window size of 3</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rollmean</span>(x, <span class="at">k =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5 6 7 8 9</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Rolling Mean with Padding Missing values are filled at the start and end.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollmean</span>(x, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA  2  3  4  5  6  7  8  9 NA</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Aligning Left or Right The rolling mean is calculated with values aligned to the left or right</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollmean</span>(x, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  3  4  5  6  7  8  9 NA NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rollmean</span>(x, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] NA NA  2  3  4  5  6  7  8  9</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'Alabama'</span>, <span class="st">'Colorado'</span>, <span class="st">'New York'</span>, <span class="st">'Ohio'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>state_data <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, county) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_cases =</span> cases <span class="sc">-</span> <span class="fu">lag</span>(cases, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, date) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">daily_cases =</span> <span class="fu">sum</span>(cases),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">daily_deaths =</span> <span class="fu">sum</span>(deaths),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">daily_new_cases =</span> <span class="fu">sum</span>(new_cases)) <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>state_filter <span class="ot">&lt;-</span> state_data <span class="sc">%&gt;%</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> states) <span class="sc">%&gt;%</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>daily_new_cases) <span class="sc">%&gt;%</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_cases =</span> daily_cases <span class="sc">-</span> <span class="fu">lag</span>(daily_cases, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">roll7_mean =</span> zoo<span class="sc">::</span><span class="fu">rollmean</span>(new_cases, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(roll7_mean <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>state_filter<span class="sc">$</span>roll7_mean <span class="ot">&lt;-</span> <span class="fu">round</span>(state_filter<span class="sc">$</span>roll7_mean, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="a">
<li>Now that I have the data modified, I can create a plot with the daily new cases and a 7-day rolling mean.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> state_filter) <span class="sc">+</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> roll7_mean, <span class="at">color =</span> roll7_mean), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> state) <span class="sc">+</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>() <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">'Greens'</span>, <span class="at">name =</span> <span class="st">'Cases Gradient'</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Date'</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Number of Cases'</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'7 Day Rolling Average Number of COVID-19 Cases'</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="a">
<li>The story of raw case counts can be misleading. I now modify the data to show why.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pop_state <span class="ot">&lt;-</span> pop_data <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTY <span class="sc">&gt;</span> <span class="st">'000'</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         STNAME <span class="sc">%in%</span> states) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fips =</span> <span class="fu">paste0</span>(STATE, COUNTY)) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(fips, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">'NAME'</span>, <span class="st">'POPE'</span>, <span class="st">'DEATHS'</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STNAME) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">POP2020 =</span> <span class="fu">sum</span>(POPESTIMATE2020),</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">POP2021 =</span> <span class="fu">sum</span>(POPESTIMATE2021),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">POP2022 =</span> <span class="fu">sum</span>(POPESTIMATE2022),</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">POP2023 =</span> <span class="fu">sum</span>(POPESTIMATE2023)) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">state =</span> <span class="st">'STNAME'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>state_join <span class="ot">&lt;-</span> <span class="fu">full_join</span>(pop_state, state_filter, <span class="at">by =</span> <span class="st">'state'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>roll7_mean) <span class="sc">%&gt;%</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percap_cases =</span> <span class="fu">if_else</span>(year <span class="sc">==</span> <span class="dv">2020</span>, new_cases<span class="sc">/</span>POP2020,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">if_else</span>(year <span class="sc">==</span> <span class="dv">2021</span>, new_cases<span class="sc">/</span>POP2021,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">if_else</span>(year <span class="sc">==</span> <span class="dv">2022</span>, new_cases<span class="sc">/</span>POP2022,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">if_else</span>(year <span class="sc">==</span> <span class="dv">2023</span>, new_cases<span class="sc">/</span>POP2023, <span class="cn">NA</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">roll7_mean =</span> zoo<span class="sc">::</span><span class="fu">rollmean</span>(percap_cases, <span class="at">k =</span> <span class="dv">7</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">align =</span> <span class="st">"right"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="a">
<li>And now plot the modified data.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> state_join) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> roll7_mean, <span class="at">color =</span> state), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_dark</span>() <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Spectral"</span>, <span class="at">name =</span> <span class="st">"State"</span>) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Date'</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'per Capita Cases'</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'7 Day per Capita Averages for COVID-19 Cases'</span>) <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="5" type="a">
<li>Briefly describe the influence scaling by population had on the analysis? Does it make some states look better? Some worse? How so? <em>Scaling standardizes cases per capita, so the state that initially looks bad based on sheer numbers, New York, actually looks to have about the same number of cases per capita as the others looked at.New York looks bad because there is more population there, so there are more total cases.</em></li>
</ol>
</section>
</section>
<section id="question-7-space-time" class="level1">
<h1><strong>Question 7</strong>: Space &amp; Time</h1>
<p>Now I want to understand how COVID has spread through time across the country. I calculate the Weighted Mean Center of the COVID-19 outbreak to better understand the movement of the virus through time.</p>
<p>To do this, we need to join the COVID data with location information. I have staged the latitude and longitude of county centers <a href="https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv">here</a>. For reference, this data was processed like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>counties <span class="ot">=</span> USAboundaries<span class="sc">::</span><span class="fu">us_counties</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">fips =</span> geoid) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">LON =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>], </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">LAT =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(counties, <span class="st">"../resources/county-centroids.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>location_dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/refs/heads/main/resources/county-centroids.csv'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>covid_location <span class="ot">&lt;-</span> <span class="fu">full_join</span>(location_dat, dat, <span class="at">by =</span> <span class="st">'fips'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The mean center of a set of spatial points is defined as the average X and Y coordinate. A weighted mean center can be found by weighting the coordinates by another variable such that:</li>
</ul>
<p><span class="math display">\[X_{coord} = \sum{(X_{i} * w_{i})} / \sum(w_{i})\]</span> <span class="math display">\[Y_{coord} = \sum{(Y_{i} * w_{i})}/ \sum(w_{i})\]</span></p>
<ul>
<li>For each date, calculate the Weighted Mean <span class="math inline">\(X_{coord}\)</span> and <span class="math inline">\(Y_{coord}\)</span> using the daily cumulative cases <em>and</em> deaths as the respective <span class="math inline">\(w_{i}\)</span>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>covid_weight <span class="ot">&lt;-</span> covid_location <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">weight_x_cases =</span> <span class="fu">sum</span>(cases<span class="sc">*</span>LON)<span class="sc">/</span><span class="fu">sum</span>(cases),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">weight_y_cases =</span> <span class="fu">sum</span>(cases<span class="sc">*</span>LAT)<span class="sc">/</span><span class="fu">sum</span>(cases),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">weight_x_deaths =</span> <span class="fu">sum</span>(deaths<span class="sc">*</span>LON)<span class="sc">/</span><span class="fu">sum</span>(deaths),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">weight_y_deaths =</span> <span class="fu">sum</span>(deaths<span class="sc">*</span>LAT)<span class="sc">/</span><span class="fu">sum</span>(deaths))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make two plots next to each other (using <code>patchwork</code>) showing cases in navy and deaths in red. Once complete, describe the differences in the plots and what they mean about the spatial patterns seen with COVID impacts. These points should are then plotted over a map of the USA states which can be added to a ggplot object with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">borders</span>(<span class="st">"state"</span>, <span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">colour =</span> <span class="st">"white"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Multiplots
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><a href="https://patchwork.data-imaginist.com/"><code>patchwork</code></a> is an R package designed for combining multiple <code>ggplot2</code> plots into a cohesive layout.</p>
<section id="key-features" class="level4">
<h4 class="anchored" data-anchor-id="key-features">Key Features:</h4>
<ul>
<li><strong>Simple Composition</strong>: Use +, /, and | operators to arrange plots intuitively.<br>
</li>
<li><strong>Flexible Layouts</strong>: Supports nesting, alignment, and customized positioning of plots.<br>
</li>
<li><strong>Annotation and Styling</strong>: Add titles, captions, and themes across multiple plots.<br>
</li>
</ul>
</section>
<section id="example" class="level4">
<h4 class="anchored" data-anchor-id="example">Example:</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, hp)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2  <span class="co"># Arrange side by side</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>This places p1 and p2 next to each other in a single figure.</p>
</section>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>pcases <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> covid_weight) <span class="sc">+</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">borders</span>(<span class="st">'state'</span>, <span class="at">fill =</span> <span class="st">'gray90'</span>, <span class="at">colour =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> weight_x_cases, <span class="at">y =</span> weight_y_cases), <span class="at">colour =</span> <span class="st">'navy'</span>) <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Longitude'</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Latitude'</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Cases'</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>pdeaths <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> covid_weight) <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">borders</span>(<span class="st">'state'</span>, <span class="at">fill =</span> <span class="st">'gray90'</span>, <span class="at">colour =</span> <span class="st">'white'</span>) <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> weight_x_deaths, <span class="at">y =</span> weight_y_deaths), <span class="at">colour =</span> <span class="st">'red4'</span>) <span class="sc">+</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Longitude'</span>,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Latitude'</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Deaths'</span>)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>pcases <span class="sc">+</span> pdeaths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p><strong>Plot Description:</strong> <em>The cases very quickly move from the West Coast into the interior of the country. There is a lag with the deaths, as they came more slowly, but eventually they also follow the same path as the number of cases. The deaths are centered in the middle of the country like the cases. There is an interesting dip in cases south, probably showing a spike in cases in Florida and Texas toward the end of this data. Both charts show an lean toward the right, when COVID hit the east coast hard and most of the cases and deaths were on the east side of the country.</em></p>
</section>
<section id="question-8-trends" class="level1">
<h1><strong>Question 8:</strong> Trends</h1>
<p>OK! This is a job well done. For the final task, leadership has noticed that it is much easier to have a solid record of deaths, while a record of cases relies on testing protocols and availability. They ask about the relationship between cases and deaths and to see if deaths can be used as a proxy for cases. You will explore the relationship between cases and deaths along with other predictors of your choosing from the population data.</p>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<ol type="a">
<li><p>Start with the raw COVID dataset, and compute county level daily new cases and deaths. Then, join it to the census data in order to use population data in the model.</p></li>
<li><p>There was a strong seasonal component to the spread of COVID-19. To account for this, so add a new column to the data for year, month, and <code>season</code> which will be one of four values: “Spring” (Mar-May), “Summer” (Jun-Aug), “Fall” (Sep-Nov), or “Winter” (Dec - Jan) based on the computed Month.</p></li>
<li><p>Next, group the data by state, year, and season and summarize the total population, new cases, and new deaths per grouping.</p></li>
<li><p>Given the case/death counts are not scaled by population, it is expected that each will exhibit a right skew behavior (you can confirm this with density plots, shapiro.test, or histrograms). Given an assumption of linear models is normality in the data, apply a log transformation to cases, deaths, and population to normalize them.</p></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We know there are 0’s in the data (cases/deaths), so we can add 1 to the data before taking the log. As the log of 0 is undefined, adding 1 ensures that the log of 0 is -Inf.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -Inf</code></pre>
</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>state_dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, county) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_cases =</span> cases <span class="sc">-</span> <span class="fu">lag</span>(cases, <span class="at">n =</span> <span class="dv">1</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">new_deaths =</span> deaths <span class="sc">-</span> <span class="fu">lag</span>(deaths, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>pop_state_cum <span class="ot">&lt;-</span> pop_data <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(COUNTY <span class="sc">&gt;</span> <span class="st">'000'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fips =</span> <span class="fu">paste0</span>(STATE, COUNTY))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>pop_state_join <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(pop_state_cum, state_dat, <span class="at">by =</span> <span class="st">'fips'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CTYNAME, STNAME, <span class="fu">contains</span>(<span class="fu">c</span>(<span class="st">'POPES'</span>, <span class="st">'DEATHS'</span>)), fips, date, county, state, cases, deaths, new_cases, new_deaths) <span class="sc">%&gt;%</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> lubridate<span class="sc">::</span><span class="fu">year</span>(date),</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">month =</span> lubridate<span class="sc">::</span><span class="fu">month</span>(date),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">season =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(month <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">'Spring'</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                                   month <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">'Summer'</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                                   month <span class="sc">&gt;=</span> <span class="dv">9</span> <span class="sc">&amp;</span> month <span class="sc">&lt;=</span> <span class="dv">11</span> <span class="sc">~</span> <span class="st">'Fall'</span>,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">'Winter'</span>))</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>pop_state_season <span class="ot">&lt;-</span> pop_state_join <span class="sc">%&gt;%</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state, year, season) <span class="sc">%&gt;%</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">seasonal_cases =</span> <span class="fu">sum</span>(new_cases),</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">seasonal_deaths =</span> <span class="fu">sum</span>(new_deaths),</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">population =</span> <span class="fu">case_when</span>(year <span class="sc">==</span> <span class="dv">2020</span> <span class="sc">~</span> <span class="fu">first</span>(POPESTIMATE2020),</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>                                   year <span class="sc">==</span> <span class="dv">2021</span> <span class="sc">~</span> <span class="fu">first</span>(POPESTIMATE2021),</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>                                   year <span class="sc">==</span> <span class="dv">2022</span> <span class="sc">~</span> <span class="fu">first</span>(POPESTIMATE2022),</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>                                   year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">~</span> <span class="fu">first</span>(POPESTIMATE2023),</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_real_</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, .))) <span class="sc">%&gt;%</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_seasonal_cases =</span> <span class="fu">log</span>(seasonal_cases),</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_seasonal_deaths =</span> <span class="fu">log</span>(seasonal_deaths),</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_population =</span> <span class="fu">log</span>(population))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-building" class="level2">
<h2 class="anchored" data-anchor-id="model-building">Model Building</h2>
<ol type="a">
<li><p>Once the data has been prepared, build a linear model (<code>lm</code>) to predict the log of cases using the log of deaths the log of population, and the season. Add an interaction term for population and deaths since the per capita realtionship is significant!</p></li>
<li><p>Once the model is built, summarize it (summary) and report the R-squared value and the p-value of the model. What does this mean for the value of its application?</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>cases_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_seasonal_cases <span class="sc">~</span> log_seasonal_deaths <span class="sc">+</span> log_population <span class="sc">+</span> log_seasonal_deaths<span class="sc">*</span>log_population <span class="sc">+</span> season, <span class="at">data =</span> pop_state_season)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cases_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_seasonal_cases ~ log_seasonal_deaths + log_population + 
    log_seasonal_deaths * log_population + season, data = pop_state_season)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1437 -0.4495 -0.0083  0.4237  3.6495 

Coefficients:
                                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                         6.84534    0.91781   7.458 3.99e-13 ***
log_seasonal_deaths                 0.59534    0.13901   4.283 2.22e-05 ***
log_population                     -0.08727    0.08206  -1.063   0.2881    
seasonSpring                       -0.81867    0.08409  -9.736  &lt; 2e-16 ***
seasonSummer                       -0.16527    0.09266  -1.784   0.0751 .  
seasonWinter                        0.15947    0.08262   1.930   0.0542 .  
log_seasonal_deaths:log_population  0.01923    0.01239   1.552   0.1213    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6392 on 492 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.8102,    Adjusted R-squared:  0.8079 
F-statistic:   350 on 6 and 492 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><strong>Results:</strong> r-squared = 0.8079, p-value &lt; 2.2e-16</p>
<p><em>Since the p-value is so low, the seasonal deaths are dependent on population and seasonal cases. Therefore the model is useful could be used to predict deaths based on cases, season, and population.</em></p>
</section>
</section>
<section id="question-9-evaluation" class="level1">
<h1><strong>Question 9:</strong> Evaluation</h1>
<p>Now that a model is built, it is time to evaluate it.</p>
<ol type="a">
<li><p>Use <code>broom::augment</code> to generate a data frame of predictions and residuals.</p></li>
<li><p>Create a scatter plot of the predicted cases vs.&nbsp;the actual cases. Add a line of best fit to the plot, and make the plot as appealing as possible. Describe the relationship that you see… are you happy with the model?</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>pred_deaths <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(cases_lm)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> pred_deaths) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> log_seasonal_deaths, <span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Seasonal Deaths (log) - Actual'</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Seasonal Deaths (log) - Predicted'</span>,</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Actual vs. Predicted Seasonal Deaths using a Linear Model'</span>) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> log_seasonal_deaths, <span class="at">y =</span> .fitted), <span class="at">color =</span> <span class="st">'navy'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> pred_deaths, <span class="fu">aes</span>(.resid)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">'navy'</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">'Residuals'</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">'Number of Cases'</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">'Distribution of Residuals in the Linear Model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="lab-01_files/figure-html/unnamed-chunk-32-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="a">
<li>A final assumption of an appropriate model is that the residuals are normally distributed. Fortunately <code>broom::augment</code> provides the .resid outputs for each feature. To visually check for residual normality, create a histogram of the residuals. How does the distribution look? Was a linear model appropriate for this case?</li>
</ol>
<p><em>The residuals are normally fitted around 0, so this does appear to be a decent model. The r2 value is around 0.80, so that does provide good model for prediction.</em></p>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
<p>And that’s it! In this lab we have explored the COVID-19 data from the New York Times, wrangled it, and built a model to predict cases from deaths and population. This is a great example of how data science can be used to inform public health decisions.</p>
<p>We covered a lot of technical tools as well spanning readr, dplyr, ggplot, lubridate, and more. We also used some more advanced tools like <code>zoo</code> for rolling averages and <code>broom</code> for model evaluation.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>